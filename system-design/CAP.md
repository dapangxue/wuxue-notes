# 分布式基本理论

## CAP理论

### 分布式系统的三个指标

1998年，加州大学的计算机科学家Eric Brewer提出了分布式系统的三个指标。

```
Consistency
Availability
Partition Tolerance
```

取三个指标的首字母，这个理论命名为CAP理论。

### Partition Tolerance

大多数的分布式系统都分布在多个子网络，每个子网络可以看做一个区，每个区之间的通信可能会失败。假设有一台服务器位于A地点，另一台服务器位于B地点，两台服务器极有可能通信失败。

系统设计的时候必须考虑分区容错性，分区容错无法避免，也就是CAP理论中的P是一定会存在的。

### Consistency

CAP理论中的一致性是强一致性，也就是对于服务器节点，写操作之后的读操作，必须读到最新的值。

<img src="./img/Consistency.PNG" width="80%" height="80%" />

如果A和B服务器对外提供同样的功能，应用写操作将数据写入A服务器中，再次请求时，请求到了B服务器，此时B服务器的数据是旧的数据，为了保证数据的一致性，需要A服务器和B服务器之间相互通信同步数据，在A服务器和B服务器通信数据的期间，B服务器不能对外提供服务，从而保证了数据的强一致性。

### Availability

CAP理论中的可用性，即服务器收到请求后，必须返回计算结果给用户。

应用程序向A或B服务器发起请求后，不管A或B服务器哪台接收到请求，都需要返回结果给应用程序。

### Consistency和Availability

由于A和B服务器可能会通信失败，也就是分区容错性一定会满足，在服务器通信失败后，为了保证一致性，服务器不会对外提供服务，直到通信恢复，数据同步完成，这种情况下没有保证可用性。为了保证可用性，即使在网络分区的情况下也需要对外提供服务，这种情况下有没有保证一致性。

通俗地讲，就是在保证了分区容错性的前提下，一致性和可用性两难全。

## BASE理论

CAP理论的三个条件在分布式系统中无法同时满足，BASE理论相当于是对CAP理论的一个补充。

> BASE理论指的是：Basically Available（基本可用）、Soft state（软状态）和Eventually Consistency（最终一致性）

BASE理论是对CAP理论的可用性和强一致性权衡的结果，核心思想就是，即使应用达不到强一致性的结果，也可以根据业务的特点，达到最终的一致性。

## 参考文献

[CAP 定理的含义](http://www.ruanyifeng.com/blog/2018/07/cap.html)

